from automata.tm.ntm import NTM

ConstantCoefficients = NTM(
    states={'q0', 'q1', 'q2', 'qb', 'q_accept'},
    # Símbolos de entrada: alfabeto completo de ecuaciones diferenciales
    input_symbols={
        'y', 'x', "'",                           # Variables y derivadas
        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',  # Dígitos
        'e', 'π', '.',                           # Constantes y decimal
        '+', '-', '*', '/', '^',                 # Operadores
        '(', ')', '=',                           # Paréntesis e igualdad
        'S', 'C', 'T', 'L', 'R', 'A',           # Funciones (mayúsculas)
        's', 'c', 't', 'I', 'E'                  # Funciones (minúsculas)
    },

    # Símbolos de cinta: incluye símbolos de entrada + símbolo blanco
    tape_symbols={
        'y', 'x', "'",
        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
        'e', 'π', '.',
        '+', '-', '*', '/', '^',
        '(', ')', '=',
        'S', 'C', 'T', 'L', 'R', 'A',
        's', 'c', 't', 'I', 'E',
        'B'  # Símbolo blanco
    },
    transitions={
        'q0': {
            'y': {('q1', 'y', 'R')},
            'x': {('q2', 'x', 'R')},
            "'": {('q0', "'", 'R')},
            '0': {('q0', '0', 'R')},
            '1': {('q0', '1', 'R')},
            '2': {('q0', '2', 'R')},
            '3': {('q0', '3', 'R')},
            '4': {('q0', '4', 'R')},
            '5': {('q0', '5', 'R')},
            '6': {('q0', '6', 'R')},
            '7': {('q0', '7', 'R')},
            '8': {('q0', '8', 'R')},
            '9': {('q0', '9', 'R')},
            'e': {('q0', 'e', 'R')},
            'π': {('q0', 'π', 'R')},
            '.': {('q0', '.', 'R')},
            '+': {('q0', '+', 'R')},
            '-': {('q0', '-', 'R')},
            '*': {('q0', '*', 'R')},
            '/': {('q0', '/', 'R')},
            '^': {('q0', '^', 'R')},
            '(': {('q0', '(', 'R')},
            ')': {('q0', ')', 'R')},
            '=': {('q0', '=', 'R')},
            'S': {('q0', 'S', 'R')},
            'C': {('q0', 'C', 'R')},
            'T': {('q0', 'T', 'R')},
            'L': {('q0', 'L', 'R')},
            'R': {('q0', 'R', 'R')},
            'A': {('q0', 'A', 'R')},
            's': {('q0', 's', 'R')},
            'c': {('q0', 'c', 'R')},
            't': {('q0', 't', 'R')},
            'I': {('q0', 'I', 'R')},
            'E': {('q0', 'E', 'R')},
            'B': {('q_accept', 'B', 'R')},
        },
        'q1': {
            'y': {('qb', 'y', 'R')},
            'x': {('qb', 'x', 'R')},
            "'": {('q1', "'", 'R')},
            '0': {('q1', '0', 'R')},
            '1': {('q1', '1', 'R')},
            '2': {('q1', '2', 'R')},
            '3': {('q1', '3', 'R')},
            '4': {('q1', '4', 'R')},
            '5': {('q1', '5', 'R')},
            '6': {('q1', '6', 'R')},
            '7': {('q1', '7', 'R')},
            '8': {('q1', '8', 'R')},
            '9': {('q1', '9', 'R')},
            'e': {('q1', 'e', 'R')},
            'π': {('q1', 'π', 'R')},
            '.': {('q1', '.', 'R')},
            '+': {('q0', '+', 'R')},
            '-': {('q0', '-', 'R')},
            '*': {('q1', '*', 'R')},
            '/': {('q1', '/', 'R')},
            '^': {('q1', '^', 'R')},
            '(': {('q1', '(', 'R')},
            ')': {('q1', ')', 'R')},
            '=': {('q0', '=', 'R')},
            'S': {('q1', 'S', 'R')},
            'C': {('q1', 'C', 'R')},
            'T': {('q1', 'T', 'R')},
            'L': {('q1', 'L', 'R')},
            'R': {('q1', 'R', 'R')},
            'A': {('q1', 'A', 'R')},
            's': {('q1', 's', 'R')},
            'c': {('q1', 'c', 'R')},
            't': {('q1', 't', 'R')},
            'I': {('q1', 'I', 'R')},
            'E': {('q1', 'E', 'R')},
            'B': {('q_accept', 'B', 'R')},
        },
        'q2': {
            'y': {('qb', 'y', 'R')},
            'x': {('q2', 'x', 'R')},
            '+': {('q0', '+', 'R')},
            '-': {('q0', '-', 'R')},
            "'": {('q2', "'", 'R')},
            '0': {('q2', '0', 'R')},
            '1': {('q2', '1', 'R')},
            '2': {('q2', '2', 'R')},
            '3': {('q2', '3', 'R')},
            '4': {('q2', '4', 'R')},
            '5': {('q2', '5', 'R')},
            '6': {('q2', '6', 'R')},
            '7': {('q2', '7', 'R')},
            '8': {('q2', '8', 'R')},
            '9': {('q2', '9', 'R')},
            'e': {('q2', 'e', 'R')},
            'π': {('q2', 'π', 'R')},
            '.': {('q2', '.', 'R')},
            '*': {('q2', '*', 'R')},
            '/': {('q2', '/', 'R')},
            '^': {('q2', '^', 'R')},
            '(': {('q2', '(', 'R')},
            ')': {('q2', ')', 'R')},
            '=': {('q0', '=', 'R')},
            'S': {('q2', 'S', 'R')},
            'C': {('q2', 'C', 'R')},
            'T': {('q2', 'T', 'R')},
            'L': {('q2', 'L', 'R')},
            'R': {('q2', 'R', 'R')},
            'A': {('q2', 'A', 'R')},
            's': {('q2', 's', 'R')},
            'c': {('q2', 'c', 'R')},
            't': {('q2', 't', 'R')},
            'I': {('q2', 'I', 'R')},
            'E': {('q2', 'E', 'R')},
            'B': {('q_accept', 'B', 'R')},
        },
        'qb': {
            'y': {('qb', 'y', 'R')},
            'x': {('qb', 'x', 'R')},
            '+': {('qb', '+', 'R')},
            '-': {('qb', '-', 'R')},
            "'": {('qb', "'", 'R')},
            '0': {('qb', '0', 'R')},
            '1': {('qb', '1', 'R')},
            '2': {('qb', '2', 'R')},
            '3': {('qb', '3', 'R')},
            '4': {('qb', '4', 'R')},
            '5': {('qb', '5', 'R')},
            '6': {('qb', '6', 'R')},
            '7': {('qb', '7', 'R')},
            '8': {('qb', '8', 'R')},
            '9': {('qb', '9', 'R')},
            'e': {('qb', 'e', 'R')},
            'π': {('qb', 'π', 'R')},
            '.': {('qb', '.', 'R')},
            '*': {('qb', '*', 'R')},
            '/': {('qb', '/', 'R')},
            '^': {('qb', '^', 'R')},
            '(': {('qb', '(', 'R')},
            ')': {('qb', ')', 'R')},
            '=': {('qb', '=', 'R')},
            'S': {('qb', 'S', 'R')},
            'C': {('qb', 'C', 'R')},
            'T': {('qb', 'T', 'R')},
            'L': {('qb', 'L', 'R')},
            'R': {('qb', 'R', 'R')},
            'A': {('qb', 'A', 'R')},
            's': {('qb', 's', 'R')},
            'c': {('qb', 'c', 'R')},
            't': {('qb', 't', 'R')},
            'I': {('qb', 'I', 'R')},
            'E': {('qb', 'E', 'R')},
        }
    },
    initial_state='q0',
    blank_symbol='B',
    final_states={'q_accept'}
)

cadenas = [
    #Aceptadas teóricamente
    ("y''+(π)^(2)*y=(e)^(-x)*T(x)"),
    ("3*y'-L(5)*y'+y=C(2*x)"),
    ("y'''+/(3)*y=9.8"),
    ("12*y''''-5*y'''+3*y''-y'+78*y=(x)^(5)*(e)^(x)"),

    #Rechazadas teóricamente
    ("(x)^(2)*y+x*y+((x)^(2)-2)*y=0"),
    ("y''-x*y'+2*y=1"),
    ("(x)^(3)*y'''+4*(x)^(2)*y''-2*x*y'+4*y=L(x)")
]

for i in range(len(cadenas)):
    try:
        resultado = ConstantCoefficients.accepts_input(cadenas[i])
        print(f"   Resultado: {'✓ ACEPTA' if resultado else '✗ RECHAZA'}")
    except Exception as e:
        print(f"   ERROR en ejecución: {e}")